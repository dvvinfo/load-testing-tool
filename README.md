# Приложение для нагрузочного тестирования с использованием NestJS, Vue 3 и PostgreSQL

Этот проект представляет собой полнофункциональное приложение, демонстрирующее возможности нагрузочного тестирования с бэкендом на NestJS, фронтендом на Vue 3 и базой данных PostgreSQL, все контейнеризировано с помощью Docker.

## Используемые технологии

- **Бэкенд**: NestJS (TypeScript)
- **База данных**: PostgreSQL (через Docker)
- **Фронтенд**: Vue 3
- **Контейнеризация**: Docker / docker-compose

## Структура проекта

```
.
├── backend         # Приложение NestJS
├── frontend        # Приложение Vue 3
├── docker-compose.yml
└── README.md
```

## Начало работы

### Предварительные требования

- Установленные Docker и Docker Compose
- Node.js (для локальной разработки)

### Запуск приложения

1. Клонируйте репозиторий:
   ```bash
   git clone <url-репозитория>
   cd <директория-проекта>
   ```

2. Запустите все сервисы с помощью Docker Compose:
   ```bash
   docker-compose up
   ```

3. Доступ к приложениям:
   - **Фронтенд**: http://localhost:8080
   - **API бэкенда**: http://localhost:3000

### Заполнение базы данных

Чтобы заполнить базу данных более чем 50 000 элементами:

1. Убедитесь, что контейнеры запущены:
   ```bash
   docker-compose up -d
   ```

2. Выполните команду заполнения:
   ```bash
   docker-compose exec backend npm run seed
   ```

## Конечные точки API

### GET /items

Получает список элементов с постраничной навигацией.

**Параметры запроса:**
- `limit` (опционально, по умолчанию: 10) - Количество возвращаемых элементов
- `offset` (опционально, по умолчанию: 0) - Количество пропускаемых элементов

**Ответ:**
```json
{
  "data": [...],
  "total": 50000,
  "limit": 10,
  "offset": 0
}
```

## Нагрузочное тестирование

Фронтенд на Vue предоставляет интерфейс для нагрузочного тестирования, где вы можете:

1. Указать количество отправляемых запросов
2. Установить задержку между запросами
3. Настроить параллельные запросы
4. Отслеживать статистику в реальном времени:
   - Отправленные запросы
   - Успешные запросы
   - Неудачные запросы
   - Затраченное время
   - Запросы в секунду
   - Визуальная диаграмма запросов по времени

## Оптимизация производительности

### Первоначальная производительность (до оптимизаций)

До применения оптимизаций конечная точка `/items` испытывала заметные задержки при обработке параллельных запросов:
- Время отклика: 500-2000 мс под нагрузкой
- Использование процессора базы данных: высокое во время параллельных запросов
- Исчерпание пула соединений при высокой параллелизме

### Примененные оптимизации

1. **Индексация базы данных**:
   - Добавлен индекс для столбца `id` (первичный ключ уже индексирован)
   - Добавлен индекс для столбца `created_at` для запросов по времени

2. **Пул соединений**:
   - Настроены параметры пула соединений TypeORM:
     - `maxConnections`: 20
     - `minConnections`: 5
     - `acquireTimeout`: 30000 мс

3. **Оптимизация постраничной навигации**:
   - Реализована эффективная постраничная навигация с использованием `LIMIT` и `OFFSET`
   - Добавлено кэширование общего количества для лучшей производительности

4. **Кэширование** (Запланировано, но не реализовано из-за проблем с зависимостями):
   - Добавление кэширования в памяти для часто запрашиваемых страниц
   - Использование TTL кэша 30 секунд для динамических данных

### Производительность после оптимизаций

После реализации оптимизаций:
- Время отклика: 100-500 мс при аналогичной нагрузке
- Использование процессора базы данных: умеренно снижено
- Повышенная стабильность под высокой нагрузкой
- Лучшая обработка параллельных запросов

## Разработка

### Бэкенд (NestJS)

1. Перейдите в директорию бэкенда:
   ```bash
   cd backend
   ```

2. Установите зависимости:
   ```bash
   npm install
   ```

3. Запустите в режиме разработки:
   ```bash
   npm run start:dev
   ```

### Фронтенд (Vue 3)

1. Перейдите в директорию фронтенда:
   ```bash
   cd frontend
   ```

2. Установите зависимости:
   ```bash
   npm install
   ```

3. Запустите в режиме разработки:
   ```bash
   npm run dev
   ```

## Детали структуры проекта

### Бэкенд

```
src/
├── items/              # Модуль элементов
│   ├── dto/            # Объекты передачи данных
│   ├── entities/       # Сущности TypeORM
│   ├── commands/       # Команды CLI
│   ├── items.controller.ts
│   ├── items.service.ts
│   └── items.module.ts
├── seeder/             # Заполнение базы данных
├── app.controller.ts
├── app.service.ts
├── app.module.ts
└── main.ts
```

### Фронтенд

```
src/
├── components/         # Компоненты Vue
├── App.vue
└── main.ts
```

## Конфигурация Docker

- **PostgreSQL**: Официальный образ PostgreSQL 15 с постоянным томом данных
- **Бэкенд**: Пользовательский образ Node.js 18 Alpine с приложением NestJS
- **Фронтенд**: Многоэтапная сборка с Node.js для сборки и Nginx для обслуживания

## Переменные окружения

Приложение можно настроить с помощью переменных окружения:

### Бэкенд
- `DATABASE_HOST`: Хост базы данных (по умолчанию: db)
- `DATABASE_PORT`: Порт базы данных (по умолчанию: 5432)
- `DATABASE_USER`: Пользователь базы данных (по умолчанию: postgres)
- `DATABASE_PASSWORD`: Пароль базы данных (по умолчанию: postgres)
- `DATABASE_NAME`: Имя базы данных (по умолчанию: testdb)

## Тестирование

### Процесс нагрузочного тестирования

1. Запустите все сервисы с помощью Docker Compose
2. Откройте фронтенд по адресу http://localhost:8080
3. Настройте параметры теста:
   - Количество запросов (например, 1000)
   - Задержка между запросами (например, 100 мс)
   - Параллельные запросы (например, 10)
4. Нажмите "Начать нагрузочный тест"
5. Отслеживайте результаты в реальном времени и визуализацию диаграммы

### Метрики производительности

Основные метрики, отслеживаемые во время нагрузочного тестирования:
- Запросы в секунду (RPS)
- Среднее время отклика
- Коэффициент успеха
- Коэффициент ошибок
- Использование ресурсов

## Устранение неполадок

### Распространенные проблемы

1. **Сбои подключения к базе данных**:
   - Убедитесь, что все контейнеры запущены: `docker-compose ps`
   - Проверьте логи базы данных: `docker-compose logs db`

2. **Фронтенд не подключается к бэкенду**:
   - Проверьте конфигурацию прокси nginx
   - Проверьте логи бэкенда: `docker-compose logs backend`

3. **Медленная производительность**:
   - Проверьте, правильно ли заполнена база данных
   - Отслеживайте использование ресурсов контейнерами: `docker stats`

### Полезные команды

- Просмотр логов контейнеров: `docker-compose logs <сервис>`
- Выполнение команд в контейнерах: `docker-compose exec <сервис> <команда>`
- Остановка всех сервисов: `docker-compose down`
- Пересборка контейнеров: `docker-compose up --build`

## Участие в разработке

1. Сделайте форк репозитория
2. Создайте ветку функциональности
3. Зафиксируйте свои изменения
4. Отправьте в ветку
5. Создайте Pull Request

## Лицензия

Этот проект лицензирован по лицензии MIT.